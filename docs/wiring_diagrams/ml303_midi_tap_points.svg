<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .ml303-board { fill: #660000; stroke: #440000; stroke-width: 3; }
      .arduino-board { fill: #006666; stroke: #004444; stroke-width: 2; }
      .midi-wire { stroke: #00CC66; stroke-width: 3; fill: none; }
      .data-wire { stroke: #0066FF; stroke-width: 3; fill: none; }
      .power-wire { stroke: #FF0000; stroke-width: 3; fill: none; }
      .ground-wire { stroke: #000000; stroke-width: 3; fill: none; }
      
      .test-point { fill: #FF6600; stroke: #CC4400; stroke-width: 2; }
      .pin-midi { fill: #00CC66; stroke: #009944; stroke-width: 1; }
      .pin-data { fill: #0066FF; stroke: #0044CC; stroke-width: 1; }
      .pin-power { fill: #FF0000; stroke: #CC0000; stroke-width: 1; }
      .pin-ground { fill: #000000; stroke: #333333; stroke-width: 1; }
      
      .label-title { font-size: 24px; font-weight: bold; fill: #000000; font-family: Arial, sans-serif; }
      .label-section { font-size: 16px; font-weight: bold; fill: #000000; font-family: Arial, sans-serif; }
      .label-component { font-size: 12px; font-weight: bold; fill: #FFFFFF; font-family: Arial, sans-serif; }
      .label-pin { font-size: 10px; font-weight: bold; fill: #000000; font-family: Arial, sans-serif; }
      .label-wire { font-size: 10px; font-weight: bold; fill: #000000; font-family: Arial, sans-serif; }
    </style>
  </defs>
  
  <!-- Background -->
  <rect width="1000" height="700" fill="#F5F5F5"/>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" class="label-title">ML-303 MIDI Interface Tap Points</text>
  <text x="500" y="55" text-anchor="middle" class="label-section">Arduino Interface to Existing MIDI Circuits</text>
  
  <!-- ML-303 Board -->
  <rect class="ml303-board" x="100" y="100" width="400" height="300" rx="15"/>
  <text x="300" y="85" text-anchor="middle" class="label-section">ML-303 V5 Main Board</text>
  
  <!-- PIC18LF452 Microcontroller -->
  <rect x="150" y="130" width="100" height="60" fill="#222222" stroke="#666666" stroke-width="2" rx="5"/>
  <text x="200" y="150" text-anchor="middle" class="label-component">PIC18LF452</text>
  <text x="200" y="165" text-anchor="middle" font-size="10" fill="#CCCCCC">Main MCU</text>
  <text x="200" y="180" text-anchor="middle" font-size="10" fill="#CCCCCC">MIDI Handler</text>
  
  <!-- MIDI IN Circuit -->
  <rect x="120" y="220" width="80" height="40" fill="#333333" stroke="#666666" stroke-width="2" rx="5"/>
  <text x="160" y="235" text-anchor="middle" class="label-component">MIDI IN</text>
  <text x="160" y="250" text-anchor="middle" font-size="10" fill="#CCCCCC">6N138 Circuit</text>
  
  <!-- MIDI OUT Circuit -->
  <rect x="320" y="220" width="80" height="40" fill="#333333" stroke="#666666" stroke-width="2" rx="5"/>
  <text x="360" y="235" text-anchor="middle" class="label-component">MIDI OUT</text>
  <text x="360" y="250" text-anchor="middle" font-size="10" fill="#CCCCCC">Current Driver</text>
  
  <!-- MIDI Tap Points -->
  <circle class="test-point" cx="160" cy="280" r="6"/>
  <text x="160" y="295" text-anchor="middle" class="label-pin">MIDI RX</text>
  <text x="160" y="308" text-anchor="middle" font-size="8" fill="#000">Pin RB5</text>
  
  <circle class="test-point" cx="200" cy="280" r="6"/>
  <text x="200" y="295" text-anchor="middle" class="label-pin">MIDI TX</text>
  <text x="200" y="308" text-anchor="middle" font-size="8" fill="#000">Pin RB4</text>
  
  <!-- Digital Ground -->
  <circle class="test-point" cx="300" cy="350" r="6"/>
  <text x="300" y="365" text-anchor="middle" class="label-pin">Digital GND</text>
  
  <!-- +5V Digital -->
  <circle class="test-point" cx="250" cy="350" r="6"/>
  <text x="250" y="365" text-anchor="middle" class="label-pin">+5V Digital</text>
  
  <!-- Arduino Section -->
  <rect class="arduino-board" x="600" y="150" width="150" height="200" rx="10"/>
  <text x="675" y="135" text-anchor="middle" class="label-section">Arduino Uno</text>
  
  <!-- Arduino MIDI pins -->
  <circle class="pin-midi" cx="620" cy="180" r="5"/>
  <text x="600" y="185" text-anchor="end" class="label-pin">A4</text>
  
  <circle class="pin-midi" cx="620" cy="200" r="5"/>
  <text x="600" y="205" text-anchor="end" class="label-pin">A5</text>
  
  <!-- Arduino power pins -->
  <circle class="pin-power" cx="620" cy="240" r="5"/>
  <text x="600" y="245" text-anchor="end" class="label-pin">5V</text>
  
  <circle class="pin-ground" cx="620" cy="260" r="5"/>
  <text x="600" y="265" text-anchor="end" class="label-pin">GND</text>
  
  <!-- Isolation Circuit -->
  <rect x="450" y="170" width="100" height="80" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" rx="8"/>
  <text x="500" y="160" text-anchor="middle" class="label-section">Isolation</text>
  <text x="500" y="190" text-anchor="middle" class="label-component">High-Z Buffer</text>
  <text x="500" y="205" text-anchor="middle" font-size="10" fill="#000">Voltage Divider</text>
  <text x="500" y="220" text-anchor="middle" font-size="10" fill="#000">Level Shift</text>
  <text x="500" y="235" text-anchor="middle" font-size="10" fill="#000">Protection</text>
  
  <!-- Buffer circuit components -->
  <rect x="470" y="260" width="20" height="6" fill="#D2B48C" stroke="#8B7355" stroke-width="1" rx="2"/>
  <text x="480" y="275" text-anchor="middle" font-size="8" fill="#000">10kΩ</text>
  
  <rect x="510" y="260" width="20" height="6" fill="#D2B48C" stroke="#8B7355" stroke-width="1" rx="2"/>
  <text x="520" y="275" text-anchor="middle" font-size="8" fill="#000">10kΩ</text>
  
  <!-- Connection Lines -->
  
  <!-- MIDI RX connection -->
  <path class="midi-wire" d="M 166 280 Q 350 300 450 210"/>
  <path class="midi-wire" d="M 550 210 Q 580 190 620 180"/>
  <text x="350" y="295" class="label-wire">MIDI RX TAP</text>
  <text x="580" y="175" class="label-wire">A4 RX</text>
  
  <!-- MIDI TX connection -->
  <path class="midi-wire" d="M 206 280 Q 370 320 450 230"/>
  <path class="midi-wire" d="M 550 230 Q 580 210 620 200"/>
  <text x="370" y="315" class="label-wire">MIDI TX TAP</text>
  <text x="580" y="195" class="label-wire">A5 TX</text>
  
  <!-- Power connections -->
  <path class="power-wire" d="M 256 350 Q 400 370 620 240"/>
  <text x="400" y="365" class="label-wire">+5V POWER</text>
  
  <path class="ground-wire" d="M 306 350 Q 420 380 620 260"/>
  <text x="420" y="375" class="label-wire">GROUND</text>
  
  <!-- Tap Point Details -->
  <rect x="100" y="450" width="800" height="230" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2" rx="10"/>
  <text x="120" y="475" class="label-section">MIDI Tap Point Implementation</text>
  
  <!-- Connection instructions -->
  <text x="120" y="505" font-size="14" font-weight="bold" fill="#000">Safe Tap Point Locations:</text>
  
  <text x="140" y="525" font-size="12" font-weight="bold" fill="#000">MIDI Receive (ML-303 → Arduino):</text>
  <text x="160" y="540" font-size="11" fill="#000">• Location: PIC18LF452 Pin RB5 (after MIDI input processing)</text>
  <text x="160" y="555" font-size="11" fill="#000">• Signal: 0-5V digital, 31.25 kbaud UART</text>
  <text x="160" y="570" font-size="11" fill="#000">• Connection: High-impedance tap to Arduino A4 via 10kΩ resistor</text>
  <text x="160" y="585" font-size="11" fill="#000">• Protection: Voltage divider (10kΩ + 10kΩ) for 2.5V max</text>
  
  <text x="140" y="610" font-size="12" font-weight="bold" fill="#000">MIDI Transmit (Arduino → ML-303):</text>
  <text x="160" y="625" font-size="11" fill="#000">• Location: PIC18LF452 Pin RB4 (before MIDI output driver)</text>
  <text x="160" y="640" font-size="11" fill="#000">• Signal: 0-5V digital, 31.25 kbaud UART</text>
  <text x="160" y="655" font-size="11" fill="#000">• Connection: Arduino A5 via 1kΩ resistor (current limiting)</text>
  <text x="160" y="670" font-size="11" fill="#000">• Note: Requires diode OR gate to prevent conflicts</text>
  
  <!-- Arduino code -->
  <text x="500" y="505" font-size="14" font-weight="bold" fill="#000">Arduino Implementation:</text>
  
  <text x="520" y="525" font-size="10" fill="#000">#include &lt;SoftwareSerial.h&gt;</text>
  <text x="520" y="540" font-size="10" fill="#000">SoftwareSerial MIDI_Tap(A4, A5); // RX, TX</text>
  <text x="520" y="555" font-size="10" fill="#000"></text>
  <text x="520" y="570" font-size="10" fill="#000">void setup() {</text>
  <text x="530" y="585" font-size="10" fill="#000">  MIDI_Tap.begin(31250); // MIDI baud</text>
  <text x="530" y="600" font-size="10" fill="#000">  // Monitor ML-303 MIDI traffic</text>
  <text x="520" y="615" font-size="10" fill="#000">}</text>
  <text x="520" y="630" font-size="10" fill="#000"></text>
  <text x="520" y="645" font-size="10" fill="#000">void loop() {</text>
  <text x="530" y="660" font-size="10" fill="#000">  if (MIDI_Tap.available()) {</text>
  <text x="540" y="675" font-size="10" fill="#000">    // Process MIDI data</text>
  
  <!-- Warning box -->
  <rect x="120" y="420" width="760" height="25" fill="#FFCCCC" stroke="#FF0000" stroke-width="2" rx="5"/>
  <text x="130" y="435" font-size="12" font-weight="bold" fill="#CC0000">⚠️ WARNING: High-impedance taps only! Never inject signals directly into ML-303 circuits.</text>
</svg>